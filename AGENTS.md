# Repository Guidelines

## Project Structure & Module Organization

- Rust 2024 crate; entry point at `src/main.rs`, which initializes the eframe application (ELNPack).
- UI shell in `src/ui.rs`; it wires the overall layout and delegates to components.
- Markdown editor encapsulated in `src/editor.rs`; all toolbar, caret handling, and text editing live here.
- Attachments panel in `src/attachments.rs`; handles attachment list, thumbnails, and file dialogs.
- Business logic in `src/archive.rs`; handles RO-Crate archive creation, file operations, and metadata generation.
- Add new Rust modules under `src/` and integration tests under `tests/` to keep responsibilities clear.
- No build script needed; egui compiles directly with the Rust code.

## Build, Test, and Development Commands

- `cargo run` — build the crate and launch the desktop app.
- `cargo check` — fast typecheck without running; use before pushing.
- `cargo fmt` — format Rust sources via rustfmt (enforced style).
- `cargo clippy --all-targets --all-features` — lint for common pitfalls; aim for zero warnings.
- `cargo test` — run the test suite (add tests as you extend logic).
- `cargo build --release` — produce an optimized binary for distribution.

## Documentation & Reference Lookup

- Use the Context7 MCP when you need library or API documentation: resolve the library id, then fetch docs via the Context7 MCP get-library-docs endpoint.
- Prefer official documentation domains returned by Context7; avoid ad-hoc web searches unless Context7 lacks coverage.

### Rustdoc conventions to follow
- Use `///` for public items and `//!` for module-level docs; start with a one-line summary ending with a period.
- Structure details with `#` headings (e.g., `# Examples`, `# Errors`, `# Panics`, `# Safety`, `# Performance`).
- Include small, runnable examples marked `no_run`/`ignore` when side effects exist; keep them minimal and dependency-free.
- Explain invariants, panics, and error cases explicitly; prefer present tense and describe behavior, not intent.
- Link related items with intra-doc links like ``[`TypeName`]`` or ``[`module::function`]``; disambiguate with full paths when needed.
- Document private helpers when it aids maintainers; keep explanations concise.

## Coding Style & Naming Conventions

- Follow rustfmt defaults (4-space indent, trailing commas where appropriate); run `cargo fmt` before committing.
- Prefer `snake_case` for functions/variables/files and `CamelCase` for types; keep module files small and focused.
- UI strings live directly in `src/ui.rs` within the egui code; prefer short, actionable labels.
- Validate user input in business logic before reflecting it in the UI to avoid inconsistent state.
- Use English language within the codebase.
- Separate UI concerns (`src/ui.rs`) from business logic (`src/archive.rs`) for maintainability and testability.
- Code comments: use sparingly to explain intent, invariants, or non-obvious control flow; avoid restating what the code already makes clear.

## Module Responsibilities

- **`src/main.rs`**: Application entry point; sets up eframe and launches the UI.
- **`src/ui.rs`**: UI composition and screens; delegates text editing to `editor`, attachments to `attachments`, and calls `archive` for business operations.
- **`src/editor.rs`**: Markdown editor component (toolbar, cursor-aware insertions, text area).
- **`src/attachments.rs`**: Attachments panel handling list, thumbnails, and file dialogs.
- **`src/archive.rs`**: Pure business logic for archive creation, file handling, name sanitization, and RO-Crate metadata generation. Filename sanitization transliterates with `deunicode`, then collapses non-alnum/whitespace to single underscores; `suggested_archive_name` must reuse this helper. No UI dependencies.

## Testing Guidelines

- Use `cargo test` for unit and integration coverage; colocate simple unit tests with modules and broader scenarios under `tests/`.
- Name tests after behavior (e.g., `submits_trimmed_input`) and keep them deterministic.
- Test business logic in `archive.rs` independently of UI; mock file system operations where appropriate.
- UI testing can focus on state management and callback logic without rendering.

## Commit & Pull Request Guidelines

- No existing history; use clear, present-tense commit messages following the Conventional Commits spec (e.g., `feat: add submit handler validation`).
- Keep commits scoped and reviewable; avoid bundling formatting-only changes with behavior changes.
- Pull requests should describe the change, note any UI updates, and link related issues. Include screenshots or short screen recordings when modifying UI behavior.
- Document manual test steps or limitations in the PR description so reviewers can reproduce quickly.

## Security & Configuration Tips

- No external assets are fetched at runtime; all UI is generated by egui at runtime.
- Do not commit secrets or tokens; use environment variables or local config files ignored by Git.
- File dialog operations use `rfd` crate for cross-platform native dialogs.
- For archive structure and metadata, align with the ELN File Format specification: https://raw.githubusercontent.com/TheELNConsortium/TheELNFileFormat/refs/heads/master/SPECIFICATION.md
